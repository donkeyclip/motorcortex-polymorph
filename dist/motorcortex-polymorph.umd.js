!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("@donkeyclip/motorcortex")):"function"==typeof define&&define.amd?define(["@donkeyclip/motorcortex"],r):(e="undefined"!=typeof globalThis?globalThis:e||self)["@donkeyclip/motorcortex-polymorph"]=r(e.MotorCortex)}(this,(function(e){"use strict";function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=r(e),n={},i={},o={},a={},s={};Object.defineProperty(s,"__esModule",{value:!0}),s._=void 0,s.SPACE=" ",s.FILL="fill",s.NONE="none",s.DRAW_LINE_VERTICAL="V",s.DRAW_LINE_HORIZONTAL="H",s.DRAW_LINE="L",s.CLOSE_PATH="Z",s.MOVE_CURSOR="M",s.DRAW_CURVE_CUBIC_BEZIER="C",s.DRAW_CURVE_SMOOTH="S",s.DRAW_CURVE_QUADRATIC="Q",s.DRAW_CURVE_QUADRATIC_CONTINUATION="T",s.DRAW_ARC="A";var u={};Object.defineProperty(u,"__esModule",{value:!0}),u.isString=function(e){return"string"==typeof e};var l={};!function(e){Object.defineProperty(e,"__esModule",{value:!0});var r=Math;e.abs=r.abs,e.min=r.min,e.max=r.max,e.floor=r.floor,e.round=r.round,e.sqrt=r.sqrt,e.pow=r.pow,e.cos=r.cos,e.asin=r.asin,e.sin=r.sin,e.tan=r.tan,e.PI=r.PI,e.QUADRATIC_RATIO=2/3,e.EPSILON=e.pow(2,-52)}(l),Object.defineProperty(a,"__esModule",{value:!0});var c=s,f=u,_=l;a.renderPath=function(e,r){if(void 0===r&&(r=_.round),f.isString(e))return e;for(var t=[],n=0;n<e.length;n++){var i=e[n];t.push(c.MOVE_CURSOR,r(i[0]),r(i[1]),c.DRAW_CURVE_CUBIC_BEZIER);for(var o=void 0,a=2;a<i.length;a+=6){var s=r(i[a]),u=r(i[a+1]),l=r(i[a+2]),v=r(i[a+3]),d=r(i[a+4]),p=r(i[a+5]);s==d&&l==d&&u==p&&v==p&&o==(o=""+s+u+l+v+d+p)||t.push(s,u,l,v,d,p)}}return t.join(c.SPACE)};var v={};Object.defineProperty(v,"__esModule",{value:!0});var d=s;v.raiseError=function(){throw new Error(Array.prototype.join.call(arguments,d.SPACE))};var p={},A={},g={},y={};Object.defineProperty(y,"__esModule",{value:!0});var h="undefined"!=typeof window&&window.navigator.userAgent;y.isEdge=/(MSIE |Trident\/|Edge\/)/i.test(h),Object.defineProperty(g,"__esModule",{value:!0});var R=y.isEdge?Array:Float32Array;g.createNumberArray=function(e){return new R(e)};var m={};Object.defineProperty(m,"__esModule",{value:!0});var P=l;m.computeAbsoluteOrigin=function(e,r,t){var n=function(e){for(var r=e[0],t=e[1],n=t,i=r,o=2;o<e.length;o+=6){var a=e[o+4],s=e[o+5];r=P.min(r,a),i=P.max(i,a),t=P.min(t,s),n=P.max(n,s)}return{x:r,w:i-r,y:t,h:n-t}}(t);return{x:n.x+n.w*e,y:n.y+n.h*r}},Object.defineProperty(A,"__esModule",{value:!0});var O=g,I=m;A.fillSegments=function e(r,t,n){var i=r.length,o=t.length;if(i<o)return e(t,r,n);t.length=i;for(var a=o;a<i;a++){var s=r[a],u=n.x,l=n.y;if(!n.absolute){var c=I.computeAbsoluteOrigin(u,l,s);u=c.x,l=c.y}for(var f=O.createNumberArray(s.length),_=0;_<s.length;_+=2)f[_]=u,f[_+1]=l;t[a]=f}};var C={},E={};Object.defineProperty(E,"__esModule",{value:!0});var b=g;E.rotatePoints=function(e,r){var t,n=e.length,i=n-r,o=b.createNumberArray(r);for(t=0;t<r;t++)o[t]=e[t];for(t=r;t<n;t++)e[t-r]=e[t];for(t=0;t<r;t++)e[i+t]=o[t]};var D={};Object.defineProperty(D,"__esModule",{value:!0});var T=l;D.distance=function(e,r,t,n){return T.sqrt((e-t)*(e-t)+(r-n)*(r-n))},Object.defineProperty(C,"__esModule",{value:!0});var U=E,x=s,M=D,S=m;C.normalizePoints=function(e,r,t,n){var i=n.length;if(n[i-2]===n[0]&&n[i-1]===n[1]){if(!e){var o=S.computeAbsoluteOrigin(r,t,n);r=o.x,t=o.y}var a,s,u=n.slice(2);i=u.length;for(var l=0;l<i;l+=6){var c=M.distance(r,r,u[l],u[l+1]);(s===x._||c<s)&&(s=c,a=l)}U.rotatePoints(u,a),n[0]=u[i-2],n[1]=u[i-1];for(l=0;l<u.length;l++)n[l+2]=u[l]}};var j={};Object.defineProperty(j,"__esModule",{value:!0});var L=l,N=g;function V(e,r){var t=r-e.length,n=Math.ceil(r/e.length),i=N.createNumberArray(r);i[0]=e[0],i[1]=e[1];for(var o=1,a=1;a<r-1;){i[++a]=e[++o],i[++a]=e[++o],i[++a]=e[++o],i[++a]=e[++o];var s=i[++a]=e[++o],u=i[++a]=e[++o];if(t)for(var l=0;l<n&&t;l++)i[a+5]=i[a+3]=i[a+1]=s,i[a+6]=i[a+4]=i[a+2]=u,a+=6,t-=6}return i}j.fillPoints=function(e,r){for(var t=e[0].length,n=0;n<t;n++){var i=e[0][n],o=e[1][n],a=L.max(i.length+r,o.length+r);e[0][n]=V(i,a),e[1][n]=V(o,a)}},j.fillSubpath=V;var W={},Q={};Object.defineProperty(Q,"__esModule",{value:!0});var w=l,z=D;Q.perimeterPoints=function(e){for(var r=e.length,t=e[r-2],n=e[r-1],i=0,o=0;o<r;o+=6)i+=z.distance(e[o],e[o+1],t,n),t=e[o],n=e[o+1];return w.floor(i)},Object.defineProperty(W,"__esModule",{value:!0});var H=Q;W.getSortedSegments=function(e){return e.map((function(e){return{points:e,perimeter:H.perimeterPoints(e)}})).sort((function(e,r){return r.perimeter-e.perimeter})).map((function(e){return e.points}))},Object.defineProperty(p,"__esModule",{value:!0});var q=A,B=C,Z=j,F=s,k=v,$=W;p.normalizePaths=function(e,r,t){t.optimize===F.FILL&&(e=$.getSortedSegments(e),r=$.getSortedSegments(r)),e.length!==r.length&&(t.optimize===F.FILL?q.fillSegments(e,r,t.origin):k.raiseError("optimize:none requires equal lengths"));var n=Array(2);if(n[0]=e,n[1]=r,t.optimize===F.FILL){for(var i=t.origin,o=i.x,a=i.y,s=i.absolute,u=0;u<e.length;u++)B.normalizePoints(s,o,a,n[0][u]),B.normalizePoints(s,o,a,n[1][u]);Z.fillPoints(n,6*t.addPoints)}return n};var X={};Object.defineProperty(X,"__esModule",{value:!0}),X.fillObject=function(e,r){for(var t in r)e.hasOwnProperty(t)||(e[t]=r[t]);return e},Object.defineProperty(o,"__esModule",{value:!0});var Y=a,G=l,J=v,K=p,ee=X,re=g,te=s,ne={addPoints:0,optimize:te.FILL,origin:{x:0,y:0},precision:0};function ie(e,r,t){var n=K.normalizePaths(e.getData(),r.getData(),t),i=n[0].length;return function(t){if(G.abs(t-0)<G.EPSILON)return e.getStringData();if(G.abs(t-1)<G.EPSILON)return r.getStringData();for(var o=Array(i),a=0;a<i;a++)o[a]=oe(n[0][a],n[1][a],t);return o}}function oe(e,r,t){for(var n=e.length,i=re.createNumberArray(n),o=0;o<n;o++)i[o]=e[o]+(r[o]-e[o])*t;return i}o.interpolatePath=function(e,r){r=ee.fillObject(r,ne),(!e||e.length<2)&&J.raiseError("invalid arguments");for(var t=e.length-1,n=Array(t),i=0;i<t;i++)n[i]=ie(e[i],e[i+1],r);var o=r.precision?function(e){return e.toFixed(r.precision)}:te._;return function(e){var r=t*e,i=G.min(G.floor(r),t-1);return Y.renderPath(n[i]((r-i)/(i+1)),o)}},o.mixPoints=oe;var ae={},se={},ue={},le={};Object.defineProperty(le,"__esModule",{value:!0});var ce=s;le.coalesce=function(e,r){return e===ce._?r:e};var fe={};Object.defineProperty(fe,"__esModule",{value:!0});var _e=l,ve=120*_e.PI/180,de=2*_e.PI;fe.arcToCurve=function e(r,t,n,i,o,a,s,u,l,c,f,_,v){if(n<=0||i<=0)return[r,t,u,l,u,l];var d,p=_e.PI/180*(+o||0),A=_e.cos(p),g=_e.sin(p),y=!!c;if(!y){var h=r,R=u,m=((r=h*A-t*-g)-(u=R*A-l*-g))/2,P=((t=h*-g+t*A)-(l=R*-g+l*A))/2,O=m*m/(n*n)+P*P/(i*i);O>1&&(n*=O=_e.sqrt(O),i*=O);var I=(a===s?-1:1)*_e.sqrt(_e.abs((n*n*i*i-n*n*P*P-i*i*m*m)/(n*n*P*P+i*i*m*m)));_=I*n*P/i+(r+u)/2,v=I*-i*m/n+(t+l)/2,c=_e.asin((t-v)/i),f=_e.asin((l-v)/i),r<_&&(c=_e.PI-c),u<_&&(f=_e.PI-f),c<0&&(c+=de),f<0&&(f+=de),s&&c>f&&(c-=de),!s&&f>c&&(f-=de)}if(_e.abs(f-c)>ve){var C=f,E=u,b=l;f=c+ve*(s&&f>c?1:-1),d=e(u=_+n*_e.cos(f),l=v+i*_e.sin(f),n,i,o,0,s,E,b,f,C,_,v)}else d=[];var D=4/3*_e.tan((f-c)/4);if(d.splice(0,0,2*r-(r+D*n*_e.sin(c)),2*t-(t-D*i*_e.cos(c)),u+D*n*_e.sin(f),l-D*i*_e.cos(f),u,l),!y)for(var T=0,U=d.length;T<U;T+=2){var x=d[T],M=d[T+1];d[T]=x*A-M*g,d[T+1]=x*g+M*A}return d},Object.defineProperty(ue,"__esModule",{value:!0});var pe=s,Ae=le,ge=v,ye=l,he=fe,Re={M:2,H:1,V:1,L:2,Z:0,C:6,S:4,Q:4,T:2,A:7};function me(e,r,t,n,i,o,a){var s=e.x,u=e.y;e.x=Ae.coalesce(o,s),e.y=Ae.coalesce(a,u),e.current.push(Ae.coalesce(r,s),t=Ae.coalesce(t,u),n=Ae.coalesce(n,s),i=Ae.coalesce(i,u),e.x,e.y),e.lc=e.c}function Pe(e){var r=e.c,t=e.t,n=e.x,i=e.y;if(r===pe.DRAW_LINE_VERTICAL)t[0]+=i;else if(r===pe.DRAW_LINE_HORIZONTAL)t[0]+=n;else if(r===pe.DRAW_ARC)t[5]+=n,t[6]+=i;else for(var o=0;o<t.length;o+=2)t[o]+=n,t[o+1]+=i}function Oe(e){return e.split(pe.SPACE).map(Ie)}function Ie(e,r){return 0===r?e:+e}ue.parsePoints=function(e){for(var r={x:0,y:0,segments:[]},t=function(e){return e.replace(/[\^\s]*([mhvlzcsqta]|\-?\d*\.?\d+)[,\$\s]*/gi," $1").replace(/([mhvlzcsqta])/gi," $1").trim().split("  ").map(Oe)}(e),n=0;n<t.length;n++){var i=t[n],o=i[0],a=o.toUpperCase(),s=a!==pe.CLOSE_PATH&&a!==o;r.c=a;var u=Re[a],l=i,c=1;do{r.t=1===l.length?l:l.slice(c,c+u),s&&Pe(r);var f=r.t,_=r.x,v=r.y,d=void 0,p=void 0,A=void 0,g=void 0,y=void 0,h=void 0;if(a===pe.MOVE_CURSOR)r.segments.push(r.current=[r.x=f[0],r.y=f[1]]);else if(a===pe.DRAW_LINE_HORIZONTAL)me(r,pe._,pe._,pe._,pe._,f[0],pe._);else if(a===pe.DRAW_LINE_VERTICAL)me(r,pe._,pe._,pe._,pe._,pe._,f[0]);else if(a===pe.DRAW_LINE)me(r,pe._,pe._,pe._,pe._,f[0],f[1]);else if(a===pe.CLOSE_PATH)me(r,pe._,pe._,pe._,pe._,r.current[0],r.current[1]);else if(a===pe.DRAW_CURVE_CUBIC_BEZIER)me(r,f[0],f[1],f[2],f[3],f[4],f[5]),r.cx=f[2],r.cy=f[3];else if(a===pe.DRAW_CURVE_SMOOTH){var R=r.lc!==pe.DRAW_CURVE_SMOOTH&&r.lc!==pe.DRAW_CURVE_CUBIC_BEZIER;me(r,d=R?pe._:2*_-r.cx,p=R?pe._:2*v-r.cy,f[0],f[1],f[2],f[3]),r.cx=f[0],r.cy=f[1]}else if(a===pe.DRAW_CURVE_QUADRATIC){var m=f[0],P=f[1];A=f[2],g=f[3],me(r,_+(m-_)*ye.QUADRATIC_RATIO,v+(P-v)*ye.QUADRATIC_RATIO,A+(m-A)*ye.QUADRATIC_RATIO,g+(P-g)*ye.QUADRATIC_RATIO,A,g),r.cx=m,r.cy=P}else if(a===pe.DRAW_CURVE_QUADRATIC_CONTINUATION)A=f[0],g=f[1],r.lc===pe.DRAW_CURVE_QUADRATIC||r.lc===pe.DRAW_CURVE_QUADRATIC_CONTINUATION?(d=_+(2*_-r.cx-_)*ye.QUADRATIC_RATIO,p=v+(2*v-r.cy-v)*ye.QUADRATIC_RATIO,y=A+(2*_-r.cx-A)*ye.QUADRATIC_RATIO,h=g+(2*v-r.cy-g)*ye.QUADRATIC_RATIO):(d=y=_,p=h=v),me(r,d,p,y,h,A,g),r.cx=y,r.cy=h;else if(a===pe.DRAW_ARC)for(var O=he.arcToCurve(_,v,f[0],f[1],f[2],f[3],f[4],f[5],f[6]),I=0;I<O.length;I+=6)me(r,O[I],O[I+1],O[I+2],O[I+3],O[I+4],O[I+5]);else ge.raiseError(r.c," is not supported");c+=u}while(c<l.length)}return r.segments},Object.defineProperty(se,"__esModule",{value:!0});var Ce=v,Ee=ue,be=s,De=/^([#|\.]|path)/i;se.convertToPathData=function(e){if(Array.isArray(e))return{data:e,stringData:be._};var r;if("string"==typeof e&&De.test(e)?e=document.querySelector(e):r=e,"string"==typeof e)return{data:Ee.parsePoints(e),stringData:r};var t=e;return"PATH"===t.tagName.toUpperCase()?(r=t.getAttribute("d"),{data:Ee.parsePoints(r),stringData:r}):Ce.raiseError("Unsupported element ",t.tagName)},Object.defineProperty(ae,"__esModule",{value:!0});var Te=se,Ue=l,xe=s,Me=function(){function e(e){var r=Te.convertToPathData(e),t=r.data,n=r.stringData;this.data=t,this.stringData=n}return e.prototype.getData=function(){return this.data},e.prototype.getStringData=function(){return this.stringData||(this.stringData=this.render())},e.prototype.render=function(e){void 0===e&&(e=Ue.round);for(var r=this.data,t=[],n=0;n<r.length;n++){var i=r[n];t.push(xe.MOVE_CURSOR,e(i[0]),e(i[1]),xe.DRAW_CURVE_CUBIC_BEZIER);for(var o=void 0,a=2;a<i.length;a+=6){var s=e(i[a]),u=e(i[a+1]),l=e(i[a+2]),c=e(i[a+3]),f=e(i[a+4]),_=e(i[a+5]);s==f&&l==f&&u==_&&c==_&&o==(o=""+s+u+l+c+f+_)||t.push(s,u,l,c,f,_)}}return t.join(xe.SPACE)},e}();ae.Path=Me,Object.defineProperty(i,"__esModule",{value:!0});var Se=o,je=ae;i.interpolate=function(e,r){return Se.interpolatePath(e.map((function(e){return new je.Path(e)})),r||{})},Object.defineProperty(n,"__esModule",{value:!0});var Le=i,Ne=n.interpolate=Le.interpolate,Ve=ae;n.Path=Ve.Path;class We extends t.default.Effect{onGetContext(){this.interpolator=Ne([this.initialValue,this.animAttributes.d],{addPoints:this.attrs.addPoints||0,origin:{x:this.attrs.originX||0,y:this.attrs.originY||0},precision:this.attrs.precision||"fill"})}getScratchValue(){return this.element.getAttribute("d")}onProgress(e){this.element.setAttribute("d",this.interpolator(this.getFraction(e)))}}return{npm_name:"@donkeyclip/motorcortex-polymorph",version:"2.1.0",incidents:[{exportable:We,name:"Polymorph",attributesValidationRules:{animatedAttrs:{type:"object",props:{d:{optional:!1,type:"string"}}},addPoints:{optional:!0,type:"number",min:0},originX:{optional:!0,type:"number",min:0,max:1},originY:{optional:!0,type:"number",min:0,max:1},precision:{optional:!0,type:"number",min:0,max:100}}}]}}));
